#!/usr/bin/env bash
# dmenu-like script for session management
# Author: Newman Sanchez (https://github.com/newmanls)

set -euo pipefail

prompt=$(uptime -p | sed -e 's/up/Uptime:/' \
    -e 's/ weeks\?/w/' \
    -e 's/ days\?/d/' \
    -e 's/ hours\?/h/' \
    -e ' s/ minutes\?/m/' \
    -e 's/,//g')
options="Shutdown\nSuspend\nReboot\nLogout\nKill process"
chosen=$(printf "%b" "${options}" | $DMENU_CMD -p "${prompt}")

kill_process() {
    ps -u "$USER" -o pid,comm --no-headers | \
        $DMENU_CMD -p "Kill process" | \
        awk '{print $1}' | \
        xargs -r kill
}

case "${chosen}" in
    Shutdown)  systemctl poweroff -i ;;
    Suspend)   systemctl suspend ;;
    Reboot)    systemctl reboot ;;
    Logout)    loginctl terminate-user "$(whoami)" ;;
    Kill*)     kill_process ;;
esac
