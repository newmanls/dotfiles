#!/usr/bin/env python3
# dwm status script written in python
# Author: Newman Sanchez (https://github.com/newmanls)

import re
from datetime import datetime
from subprocess import run, PIPE
from time import sleep

LABELS = {
    "network_on": "󰛳  ",
    "network_off": "󰲛  ",
    "network_wifi_on": "󰤨  ",
    "network_wifi_off": "󰤭  ",
}

def date():
    date = datetime.now().strftime("%a %b %d %H:%M")

    return date

def network():
    cmd = ["nmcli", "-t", "-g", "NAME,TYPE", "c", "s", "--active"]
    network = run(cmd, stdout=PIPE, text=True).stdout
    network_name, network_type = network.splitlines()[0].split(":")

    if re.search("ethernet", network_type):
        label = LABELS["network_on"]
    elif re.search("wireless", network_type):
        label = LABELS["network_wifi_on"]
    else:
        label = LABELS["network_off"]
        network_name = "disconnected"

    return label + network_name

if __name__ == "__main__":
    DEFAULT_MODULES = [ "network", "date" ]
    SEPARATOR = "  "

    modules = DEFAULT_MODULES

    while True:
        status = [eval(module)() for module in modules]
        run(["xsetroot", "-name", SEPARATOR.join(status)])
        sleep(1)
