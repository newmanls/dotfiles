# vim:ft=sh
set shellopts   '-eu'
set ifs         "\n"
set icons
set scrolloff   8
set cleaner     '~/.config/lf/cleaner.sh'
set previewer   '~/.config/lf/scope.sh'
set ratios 1:1

cmd on-quit     $~/.config/lf/cleaner.sh
cmd open        $~/.config/lf/rifle.sh
cmd open-with   &setsid -f ${1} ${fx}
cmd mkdir       %mkdir ${@}
cmd setbg       &setbg ${f}
cmd bulk-rename $renamer ${fx}

cmd extract !{{
    clear
    for file in ${fx}; do
        aunpack -- "${file}"
    done
}}

cmd link %{{
    files="${XDG_DATA_HOME:-${HOME}/.local/share}/lf/files"
    mode=$(sed -n '1p' "${files}")
    list=$(sed '1d' "${files}")

    [ "${mode}" = 'copy' ] && ln -vs "${list}" "${PWD}"

    lf -remote 'send clear'
}}

cmd recol ${{
    width=$(tput cols)

    if [ ${width} -le 80 ]; then
        lf -remote 'send set nopreview'
        ~/.config/lf/cleaner.sh
        lf -remote 'send set ratios 1'
    else
        lf -remote 'send set ratios 1:1'
        lf -remote 'send set preview'
    fi
}}

cmd yank &{{
    case ${1} in
        dir)  dirname "${f}" ;;
        name) basename "${f}" ;;
        path) readlink -f "${f}" ;;
    esac | tr -d '\n' | xclip -selection clipboard
}}

map c
map d
map p
map r
map u
map y

map gd cd /dev
map ge cd /etc
map gm cd /media
map gM cd /mnt
map go cd /opt
map gp cd /tmp
map gr cd /
map gs cd /srv
map gu cd /usr
map gv cd /var

map dd cut
map dD delete

map yy copy
map yp yank path
map yb yank dir
map yw yank name

map pp paste
map pl link

map A  rename
map I  push A<c-a>
map S  push A<c-u>
map a  push A<a-b><a-b><a-f>
map cw push A<a-b><a-b><a-f><c-u>

map o  push :open-with<space>

map xe extract
map xw setbg
map xx $${f}
map xX !${f}

map =  recol

map <enter> open
map <esc>   :unselect; clear
